@*
    SeoMetaTags.razor - Dynamic SEO Meta Tags Component
    Provides dynamic meta tags, Open Graph, and Twitter Card support for SEO optimization.

    Usage:
    <SeoMetaTags
        Title="Course Title"
        Description="Course description for search engines"
        Keywords="online course, e-learning, programming"
        ImageUrl="https://example.com/image.jpg"
        PageType="product" />

    Created: 2025-12-07
    Version: 1.0
*@

@using Microsoft.AspNetCore.Components.Web
@inject NavigationManager Navigation

<HeadContent>
    @* Primary Meta Tags *@
    <title>@GetFullTitle()</title>
    <meta name="title" content="@GetFullTitle()" />
    <meta name="description" content="@GetSafeDescription()" />
    @if (!string.IsNullOrWhiteSpace(Keywords))
    {
        <meta name="keywords" content="@Keywords" />
    }
    <link rel="canonical" href="@GetCanonicalUrl()" />

    @* Language and Locale *@
    <meta name="language" content="@Language" />
    <meta http-equiv="content-language" content="@Language" />

    @* Robots *@
    <meta name="robots" content="@RobotsDirective" />

    @* Open Graph / Facebook *@
    <meta property="og:type" content="@PageType" />
    <meta property="og:url" content="@GetCanonicalUrl()" />
    <meta property="og:title" content="@GetFullTitle()" />
    <meta property="og:description" content="@GetSafeDescription()" />
    @if (!string.IsNullOrWhiteSpace(ImageUrl))
    {
        <meta property="og:image" content="@GetAbsoluteImageUrl()" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="630" />
        <meta property="og:image:alt" content="@Title" />
    }
    <meta property="og:site_name" content="InsightLearn" />
    <meta property="og:locale" content="@OgLocale" />

    @* Twitter Card *@
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="@GetCanonicalUrl()" />
    <meta name="twitter:title" content="@GetFullTitle()" />
    <meta name="twitter:description" content="@GetSafeDescription()" />
    @if (!string.IsNullOrWhiteSpace(ImageUrl))
    {
        <meta name="twitter:image" content="@GetAbsoluteImageUrl()" />
        <meta name="twitter:image:alt" content="@Title" />
    }

    @* Additional SEO Tags *@
    @if (!string.IsNullOrWhiteSpace(Author))
    {
        <meta name="author" content="@Author" />
    }
    @if (PublishedDate.HasValue)
    {
        <meta property="article:published_time" content="@PublishedDate.Value.ToString("yyyy-MM-ddTHH:mm:ssZ")" />
    }
    @if (ModifiedDate.HasValue)
    {
        <meta property="article:modified_time" content="@ModifiedDate.Value.ToString("yyyy-MM-ddTHH:mm:ssZ")" />
    }
</HeadContent>

@code {
    /// <summary>
    /// Page title (without site name suffix)
    /// </summary>
    [Parameter]
    public string Title { get; set; } = "";

    /// <summary>
    /// Meta description (155-160 characters recommended)
    /// </summary>
    [Parameter]
    public string Description { get; set; } = "";

    /// <summary>
    /// Comma-separated keywords
    /// </summary>
    [Parameter]
    public string Keywords { get; set; } = "";

    /// <summary>
    /// Featured image URL (relative or absolute)
    /// </summary>
    [Parameter]
    public string ImageUrl { get; set; } = "";

    /// <summary>
    /// Open Graph page type: website, article, product, video.other
    /// </summary>
    [Parameter]
    public string PageType { get; set; } = "website";

    /// <summary>
    /// Override canonical URL (defaults to current page URL)
    /// </summary>
    [Parameter]
    public string CanonicalUrl { get; set; } = "";

    /// <summary>
    /// Content author name
    /// </summary>
    [Parameter]
    public string Author { get; set; } = "";

    /// <summary>
    /// Content language (ISO 639-1 code)
    /// </summary>
    [Parameter]
    public string Language { get; set; } = "en";

    /// <summary>
    /// Open Graph locale (e.g., en_US, it_IT)
    /// </summary>
    [Parameter]
    public string OgLocale { get; set; } = "en_US";

    /// <summary>
    /// Robots meta directive
    /// </summary>
    [Parameter]
    public string RobotsDirective { get; set; } = "index, follow";

    /// <summary>
    /// Original publish date
    /// </summary>
    [Parameter]
    public DateTime? PublishedDate { get; set; }

    /// <summary>
    /// Last modified date
    /// </summary>
    [Parameter]
    public DateTime? ModifiedDate { get; set; }

    /// <summary>
    /// Whether to append site name to title
    /// </summary>
    [Parameter]
    public bool AppendSiteName { get; set; } = true;

    private const string SiteName = "InsightLearn";
    private const string DefaultDescription = "InsightLearn - Professional online learning platform. Master new skills with expert-led courses in programming, design, business, and more.";
    private const int MaxDescriptionLength = 160;

    private string GetFullTitle()
    {
        if (string.IsNullOrWhiteSpace(Title))
            return SiteName;

        return AppendSiteName ? $"{Title} | {SiteName}" : Title;
    }

    private string GetSafeDescription()
    {
        var desc = string.IsNullOrWhiteSpace(Description) ? DefaultDescription : Description;

        // Truncate to recommended length
        if (desc.Length > MaxDescriptionLength)
        {
            desc = desc.Substring(0, MaxDescriptionLength - 3) + "...";
        }

        return desc;
    }

    private string GetCanonicalUrl()
    {
        if (!string.IsNullOrWhiteSpace(CanonicalUrl))
        {
            // If absolute URL provided, use it
            if (CanonicalUrl.StartsWith("http"))
                return CanonicalUrl;

            // Make relative URL absolute
            return GetBaseUrl() + CanonicalUrl.TrimStart('/');
        }

        // Default to current page URL
        return Navigation.Uri;
    }

    private string GetAbsoluteImageUrl()
    {
        if (string.IsNullOrWhiteSpace(ImageUrl))
            return "";

        if (ImageUrl.StartsWith("http"))
            return ImageUrl;

        return GetBaseUrl() + ImageUrl.TrimStart('/');
    }

    private string GetBaseUrl()
    {
        return "https://www.insightlearn.cloud/";
    }
}
